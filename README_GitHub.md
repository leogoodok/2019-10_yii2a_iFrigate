#  GitHub репозиторий выполнения тестового задания от "Интернет Фрегат"

yii2aifrigate.wotskill

Выполнено на основе Расширенного шаблона приложения, переделанного:

- для использования на одном виртуальном хостинге;
- под использование только "bootstrap4" без "bootstrap3".

Задание в файле "README_Ifrigate.md".

## Ход выполнения.

1. Создание БД, пользователей БД, настройка подключения к БД.

2. Настройка почтовой службы (компонент 'mailer') и почтовых ящиков администратора, поддержки и т.д.

3. Создание Администратора приложения: "ifrigate".

  Прим. Первый зарегистрированный пользователь станет Администратором.

4. Обновление компонентов Yii2 с использованием "composer".

5. Создание "COMMON" части приложения (Общей для "frontend" и "backend").

5.1. Модель "TabMessage" (потомок класса "ActiveRecord") таблицы БД "message"
    (сообщений администратору) в файле "\common\models\db\TabMessage.php".

6. Создание "FRONTEND" части приложения.

6.1 Представлений (views):

  - Основного шаблова страниц, в файле "\frontend\views\layouts\main.php".
  - "Отправить сообщение администратору", в файле "\frontend\views\site\contact.php".
  - "Вывода ошибок", в файле "\frontend\views\site\error.php".
  - "Зарегистрироваться", в файле "\frontend\views\site\signup.php".
  - "Войти", в файле "\frontend\views\site\login.php".

6.2. Контроллер "SiteController", в файле "\frontend\controllers\SiteController.php".

6.2.1. Создание/редактирование в Контроллере, Поведения и Действий:

  - "actionContact" редеринга Представления "\frontend\views\site\contact.php".
  - "actionLogin" редеринга Представления "Войти" "\frontend\views\site\login.php".
  - "actionLogout" Выхода из текущей авторизации пользователя.
  - "actionSignup" редеринга Представления "Зарегистрироваться" "\frontend\views\site\signup.php".

6.3. Модели Отправки сообщения администратору "ContactForm" (по почте и запись БД) в файле "\frontend\models\ContactForm.php".

7. Создание "BACKEND" части приложения.

7.1. Представлений (views):

  - Основного шаблова страниц, в файле "\backend\config\main.php".
  - "Отображения сообщений администратору", в файле "\backend\views\site\message.php".
  - JS скриптов для представления "message", в файле "\docs\admin\js\message.js"

7.2. Контроллер "SiteController", в файле "\backend\controllers\SiteController.php".

7.2.1. Создание/редактирование в Контроллере, Поведения и Действий:

  - "actionMessage" редеринга Представления "\backend\views\site\message.php".
  - "actionLogin" редеринга Представления "Войти", "\backend\views\site\login.php".
  - "actionLogout" Выхода из текущей авторизации пользователя.

7.3. Моделей.

7.3.1. Модель "MessageForm" отображения сообщений администратору, в файле "\backend\models\MessageForm.php".

7.3.2. Модель "MessageAction" Получения и обработки POST данных, обновления и удаления сообщений в БД, в файле "\backend\models\MessageAction.php".

## Особенности реализации

1. BACKEND часть, страница "Сообщения администратору". Возможна одновременная работа с данными сообщений нескольких пользователей (открыто несколько страниц). Для обеспечения корректной обработки запросов на удаление сообщений и(или) изменения их статуса:

  - В методах Модели "MessageAction" перед каждым действием удаления/изменения данных в БД осуществляется проверка наличия соответствующих строк в таблице БД.

2. В BACKEND, странице "Сообщения администратору" реализована  возможность удаления и(или) изменения статусов нескольких сообщений. Т.е. при отправке формы в Контроллер передаются значения "checkbox" (удалить) и "select" (статус сообщения) всех отображаемых сообщений, независимо от того были ли внесены изменения или нет. Поэтому при обработке полученных POST-параметров в моделе осуществляется фильтрация входных данных перед внесением изменений в БД.

  - Значения параметров "MessageAction[delete][]" (checkbox) фильтруются по значению отличное от "empty" (пусто, 0). После фильтрации выполняются действия удаления.
  - Значения параметров "MessageAction[status][]" (select) фильтруются по значению отличное от записанного в БД, т.е текущего статуса сообщения. При этом выполняется дополнительный запрос в БД для каждого обрабатаемого параметра.

3. В BACKEND, страница "Сообщения администратору". Для исключения лишних (проверочных) запросов в БД при фильтрации "измененных" статусов сообщений к Представлению подключается JS-скрипт выполняющий:

  - После построения страницы, для всех "select" (статус сообщения), осуществляется: удаление атрибутов "name" с записью их значений в атрибут "data-name"; запись "исходного" значения "select" в атрибут "data-value".
  - При изменении значения "select" осуществляется проверка на равенство "нового" и "исходного" значений. Если значения отличаются, то изменяется цвет фона "select"-а и добавляется атрибут "name" (удаленный ранее), иначе цвет фона сбрасывается и удаляется атрибут "name".
